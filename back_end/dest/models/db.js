"use strict";var _regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=require("babel-runtime/helpers/asyncToGenerator"),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2);function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var MongoDB=require("mongodb"),MongoClient=MongoDB.MongoClient,debug=require("debug")("koa-mongo"),genericPool=require("generic-pool"),defaultOptions={host:"localhost",port:27017,db:"test",max:100,min:1};function mongo(a){var r,u=(r=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function e(r){return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.release(r);case 2:debug("Release one connection (min: %s, max: %s, poolSize: %s)",a.min,a.max,s.size);case 3:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)}),e=(a=Object.assign({},defaultOptions,a)).uri||a.url;e||(e=a.user&&a.pass?"mongodb://"+a.user+":"+a.pass+"@"+a.host+":"+a.port+"/"+a.db:"mongodb://"+a.host+":"+a.port+"/"+a.db);var n,s=genericPool.createPool({create:function(){return MongoClient.connect(e)},destroy:function(e){return e.close()}},a);return n=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function e(n,t){var o=this;return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",s.acquire().then(function(){var r=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function e(r){return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n.mongo=r,debug("Acquire one connection (min: %s, max: %s, poolSize: %s)",a.min,a.max,s.size),e.abrupt("return",t());case 3:case"end":return e.stop()}},e,o)}));return function(e){return r.apply(this,arguments)}}()).then((0,_asyncToGenerator3.default)(_regenerator2.default.mark(function e(){return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(n.mongo);case 2:case"end":return e.stop()}},e,o)}))).catch(function(){var r=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function e(r){return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(n.mongo);case 2:throw r;case 3:case"end":return e.stop()}},e,o)}));return function(e){return r.apply(this,arguments)}}()));case 1:case"end":return e.stop()}},e,this)})),function(e,r){return n.apply(this,arguments)}}module.exports=mongo,Object.assign(module.exports,MongoDB);